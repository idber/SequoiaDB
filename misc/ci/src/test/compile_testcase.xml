<project basedir="../../">
   <taskdef resource="net/sf/antcontrib/antlib.xml">
      <classpath>
         <pathelement location="${basedir}/lib/ant-contrib-1.0b2.jar" />
      </classpath>
   </taskdef>

   <macrodef name="compileccase">
      <attribute name="srcdir"/>
      <sequential>         
         <property name="scons_cmd" value="--dd " />         
         <echo message="exec cmd: scons ${scons_cmd}"/>
         <echo message="exec dir: @{srcdir}"/>
         <exec executable="scons" dir="@{srcdir}" failonerror="true" logError="true">
            <arg line="${scons_cmd}" />
         </exec>
         <delete includeemptydirs="true" failonerror="true">
            <fileset dir="@{srcdir}" includes="**/*" excludes="build_test/**/*,testcase.conf,*node.conf"/>
         </delete>
         <move todir="@{srcdir}">
            <fileset dir="@{srcdir}/build_test" />
         </move>
         <for param="conffile">
            <path>
               <fileset dir="@{srcdir}" includes="*.node.conf" excludes=""/>
            </path>
            <sequential>
               <var name="case_name" unset="true"/>
               <basename property="case_name" file="@{conffile}" suffix=".node.conf"/>
               <copy file="@{conffile}" tofile="@{srcdir}/${case_name}.static.node.conf"/>
            </sequential>
         </for>
      </sequential>
   </macrodef>
   
   <macrodef name="compilemongoccase">
      <attribute name="srcdir"/>
      <sequential>         
         <property name="scons_cmd" value="--dd " />         
         <echo message="exec cmd: scons ${scons_cmd}"/>
         <echo message="exec dir: @{srcdir}"/>
         <exec executable="scons" dir="@{srcdir}" failonerror="true" logError="true">
            <arg line="${scons_cmd}" />
         </exec>
         <delete includeemptydirs="true" failonerror="true">
            <fileset dir="@{srcdir}" includes="**/*" excludes="build_test/**/*,lib/**/*,testcase.conf"/>
         </delete>
         <move todir="@{srcdir}">
            <fileset dir="@{srcdir}/build_test" />
         </move>
      </sequential>
   </macrodef>   
   
   <macrodef name="compilecase">
      <attribute name="srcdir"/>
      <attribute name="type"/>
      <sequential>
         <switch value="@{type}">
            <case value="java">
               <compilejavacase srcdir="@{srcdir}" />
            </case>
            <case value="c">
               <compileccase srcdir="@{srcdir}" />
            </case>
            <case value="cpp">
               <compileccase srcdir="@{srcdir}" />
            </case>
            <case value="mongoc">
               <compilemongoccase srcdir="@{srcdir}" />
            </case>
            <default/>
         </switch>        
      </sequential>
   </macrodef>
   

   
</project>